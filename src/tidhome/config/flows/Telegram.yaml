- id: f6aef2f1.dd52e8
  type: tab
  label: Telegram
  disabled: false
  info: ''
- id: 42b9a882.0c7548
  type: catch
  z: f6aef2f1.dd52e8
  name: ''
  scope: null
  uncaught: false
  x: 100
  'y': 80
  wires:
    - - 98c9017f.76bca
- id: 98c9017f.76bca
  type: link out
  z: f6aef2f1.dd52e8
  name: General CatchAll
  links:
    - 1bf42829.b3e0b8
  x: 255
  'y': 80
  wires: []
- id: d020562c.8333a8
  type: telegram sender
  z: f6aef2f1.dd52e8
  name: Send
  bot: 4fc69d2d.235124
  outputs: 1
  x: 880
  'y': 210
  wires:
    - - fa16035d.0f0fd8
- id: fa16035d.0f0fd8
  type: debug
  z: f6aef2f1.dd52e8
  name: Status
  active: true
  tosidebar: true
  console: false
  tostatus: false
  complete: 'true'
  targetType: full
  x: 1040
  'y': 210
  wires: []
- id: 20133b84.b44ca4
  type: mqtt in
  z: f6aef2f1.dd52e8
  name: notifications/telegram
  topic: notifications/telegram
  qos: '2'
  datatype: auto
  broker: c38452a5.4f84e8
  inputs: 0
  x: 140
  'y': 160
  wires:
    - - e8dfc067.c65a1
- id: b52ace9b.c4f7f
  type: function
  z: f6aef2f1.dd52e8
  name: Render notification event
  func: |-
    msg.payload = {
        "chatId": msg.telegramrecipients,
        "type": "message",
        "options": { "parse_mode": "Markdown" },
        "content": msg.payload
    }
    return msg;
  outputs: 1
  noerr: 0
  initialize: ''
  finalize: ''
  libs: []
  x: 690
  'y': 210
  wires:
    - - d020562c.8333a8
- id: 586ca451.0700d4
  type: comment
  z: f6aef2f1.dd52e8
  name: Publish Telegram message to K
  info: ''
  x: 170
  'y': 120
  wires: []
- id: e8dfc067.c65a1
  type: credentials
  z: f6aef2f1.dd52e8
  name: K-C
  props:
    - value: telegramrecipients
      type: msg
  x: 320
  'y': 210
  wires:
    - - ec21e2dfc2fb77be
- id: f7290145.4541
  type: telegram command
  z: f6aef2f1.dd52e8
  name: /help
  command: /help
  bot: 4fc69d2d.235124
  strict: false
  hasresponse: false
  outputs: 2
  x: 90
  'y': 400
  wires:
    - - 2a90a04d.2f6e98
    - []
- id: 42720d76.713b3c
  type: telegram sender
  z: f6aef2f1.dd52e8
  name: Send
  bot: 4fc69d2d.235124
  outputs: 1
  x: 450
  'y': 350
  wires:
    - - 20cc8013.f8d02
- id: 2a90a04d.2f6e98
  type: function
  z: f6aef2f1.dd52e8
  name: ''
  func: >-
    var helpMessage = "/help - shows help\n";

    helpMessage += "/status - request for status\n";

    helpMessage += "/meteo - request for meteo\n";


    helpMessage += "Your chat id is " + msg.payload.chatId + "\n";

    helpMessage += "You are welcome: "+ msg.originalMessage.from.username +
    "\n";


    msg.payload.content = helpMessage;

    return msg;
  outputs: 1
  noerr: 0
  initialize: ''
  finalize: ''
  x: 270
  'y': 350
  wires:
    - - 42720d76.713b3c
- id: 20cc8013.f8d02
  type: debug
  z: f6aef2f1.dd52e8
  name: Status
  active: false
  tosidebar: true
  console: false
  tostatus: false
  complete: 'true'
  targetType: full
  x: 620
  'y': 350
  wires: []
- id: 118b2ea9.b320d1
  type: telegram command
  z: f6aef2f1.dd52e8
  name: /start
  command: /start
  bot: 4fc69d2d.235124
  strict: false
  hasresponse: false
  useregex: false
  removeregexcommand: false
  outputs: 1
  x: 90
  'y': 350
  wires:
    - - 2a90a04d.2f6e98
- id: a7974ba.f02b438
  type: comment
  z: f6aef2f1.dd52e8
  name: HELP
  info: ''
  x: 90
  'y': 310
  wires: []
- id: 37f44010.1082a
  type: telegram command
  z: f6aef2f1.dd52e8
  name: /vol
  command: /vol
  description: ''
  registercommand: false
  language: ''
  bot: 4fc69d2d.235124
  strict: false
  hasresponse: false
  useregex: false
  removeregexcommand: false
  outputs: 1
  x: 90
  'y': 560
  wires:
    - - 6e059c3f.301864
- id: 8d0d171f.e98ce
  type: comment
  z: f6aef2f1.dd52e8
  name: Ouverture/Fermeture - Volets
  info: ''
  x: 160
  'y': 520
  wires: []
- id: 6e059c3f.301864
  type: switch
  z: f6aef2f1.dd52e8
  name: ''
  property: originalMessage.text
  propertyType: msg
  rules:
    - t: cont
      v: up
      vt: str
    - t: cont
      v: down
      vt: str
    - t: else
  checkall: 'false'
  repair: false
  outputs: 3
  x: 260
  'y': 590
  wires:
    - - 6f1b9a71afbd13ec
    - - 8608c6bea9d4521a
    - - acc99ab81795114d
- id: a0f1b25d.56ebd8
  type: link out
  z: f6aef2f1.dd52e8
  name: ''
  mode: link
  links:
    - f576c3026a84db30
  x: 765
  'y': 580
  wires: []
- id: 3f7706b3.bd9a5a
  type: debug
  z: f6aef2f1.dd52e8
  name: Debug
  active: false
  tosidebar: true
  console: false
  tostatus: false
  complete: 'true'
  targetType: full
  statusVal: ''
  statusType: auto
  x: 620
  'y': 660
  wires: []
- id: ec21e2dfc2fb77be
  type: switch
  z: f6aef2f1.dd52e8
  name: not empty
  property: payload
  propertyType: msg
  rules:
    - t: nempty
  checkall: 'true'
  repair: false
  outputs: 1
  x: 480
  'y': 210
  wires:
    - - b52ace9b.c4f7f
- id: acc99ab81795114d
  type: function
  z: f6aef2f1.dd52e8
  name: Parse
  func: |-

    function isNumeric(n) { 
          return !isNaN(parseFloat(n)) && isFinite(n); 
    }

    if(isNumeric(msg.payload.content)) {
        var position = Number(msg.payload.content)
        return {
            position: position
        };
    }
  outputs: 1
  noerr: 0
  initialize: ''
  finalize: ''
  libs: []
  x: 420
  'y': 660
  wires:
    - - 3f7706b3.bd9a5a
      - 6e5fe766309ce370
- id: 6f1b9a71afbd13ec
  type: change
  z: f6aef2f1.dd52e8
  name: up = 0
  rules:
    - t: set
      p: position
      pt: msg
      to: '0'
      tot: num
  action: ''
  property: ''
  from: ''
  to: ''
  reg: false
  x: 420
  'y': 580
  wires:
    - - 6e5fe766309ce370
- id: 8608c6bea9d4521a
  type: change
  z: f6aef2f1.dd52e8
  name: down = 100
  rules:
    - t: set
      p: position
      pt: msg
      to: '100'
      tot: num
  action: ''
  property: ''
  from: ''
  to: ''
  reg: false
  x: 440
  'y': 620
  wires:
    - - 6e5fe766309ce370
- id: f4319bb765b32dae
  type: telegram command
  z: f6aef2f1.dd52e8
  name: /voletH
  command: /voletH
  description: ''
  registercommand: false
  language: ''
  bot: 4fc69d2d.235124
  strict: false
  hasresponse: false
  useregex: false
  removeregexcommand: false
  outputs: 1
  x: 90
  'y': 760
  wires:
    - - 6493b109d45dc1c7
- id: 6493b109d45dc1c7
  type: switch
  z: f6aef2f1.dd52e8
  name: ''
  property: originalMessage.text
  propertyType: msg
  rules:
    - t: cont
      v: up
      vt: str
    - t: cont
      v: mid
      vt: str
    - t: cont
      v: down
      vt: str
    - t: else
  checkall: 'false'
  repair: false
  outputs: 4
  x: 260
  'y': 760
  wires:
    - - 5892c03f96d976bc
    - []
    - - f3bac08e3f55f2aa
    - []
- id: 5892c03f96d976bc
  type: change
  z: f6aef2f1.dd52e8
  name: up = 0
  rules:
    - t: set
      p: payload
      pt: msg
      to: '0'
      tot: num
  action: ''
  property: ''
  from: ''
  to: ''
  reg: false
  x: 420
  'y': 750
  wires:
    - - e7e52fec716f59a2
- id: f3bac08e3f55f2aa
  type: change
  z: f6aef2f1.dd52e8
  name: down = 100
  rules:
    - t: set
      p: payload
      pt: msg
      to: '100'
      tot: num
  action: ''
  property: ''
  from: ''
  to: ''
  reg: false
  x: 440
  'y': 790
  wires:
    - - e7e52fec716f59a2
- id: e7e52fec716f59a2
  type: link out
  z: f6aef2f1.dd52e8
  name: ''
  links:
    - 4343d80627f170c9
  x: 585
  'y': 750
  wires: []
- id: 873226ce114ec6aa
  type: telegram command
  z: f6aef2f1.dd52e8
  name: /rad
  command: /rad
  description: ''
  registercommand: false
  language: ''
  bot: 4fc69d2d.235124
  strict: false
  hasresponse: false
  useregex: false
  removeregexcommand: false
  outputs: 1
  x: 90
  'y': 890
  wires:
    - - 7c59f8a6fede21fe
      - 03874918a788dc4d
- id: 7c59f8a6fede21fe
  type: switch
  z: f6aef2f1.dd52e8
  name: ''
  property: payload.content
  propertyType: msg
  rules:
    - t: cont
      v: a
      vt: str
    - t: cont
      v: c
      vt: str
    - t: cont
      v: e
      vt: str
    - t: else
  checkall: 'false'
  repair: false
  outputs: 4
  x: 260
  'y': 890
  wires:
    - - 793f6369000801a1
    - - d8336f52c2dabcac
    - - 2945bb0883a55a36
    - []
- id: 793f6369000801a1
  type: link out
  z: f6aef2f1.dd52e8
  name: ''
  links:
    - 32ea48f887dcaf01
    - 1289ec8160b383c0
  x: 395
  'y': 870
  wires: []
- id: d8336f52c2dabcac
  type: link out
  z: f6aef2f1.dd52e8
  name: ''
  links:
    - f59fd05791a47896
    - 8b59b8b09ecd5508
  x: 395
  'y': 910
  wires: []
- id: 2945bb0883a55a36
  type: link out
  z: f6aef2f1.dd52e8
  name: ''
  links:
    - b08009e947680796
    - fd31e45552eeb4e5
  x: 395
  'y': 950
  wires: []
- id: 03874918a788dc4d
  type: debug
  z: f6aef2f1.dd52e8
  name: ''
  active: true
  tosidebar: true
  console: false
  tostatus: false
  complete: 'true'
  targetType: full
  statusVal: ''
  statusType: auto
  x: 260
  'y': 990
  wires: []
- id: efdc44ad7838b791
  type: debug
  z: f6aef2f1.dd52e8
  name: Status
  active: false
  tosidebar: true
  console: false
  tostatus: false
  complete: 'true'
  targetType: full
  x: 320
  'y': 200
  wires: []
- id: c81f8f99a238d079
  type: link out
  z: f6aef2f1.dd52e8
  name: ''
  mode: link
  links:
    - e084ff66fb81099d
  x: 395
  'y': 1070
  wires: []
- id: 2f30621f40aa8285
  type: link in
  z: f6aef2f1.dd52e8
  name: Telegram-To-K
  links:
    - 0a19614dac750dc9
    - 84b1892ac15ea678
    - e7a7cb7a8df21f27
    - ecb2912f7071e62b
    - fecb20f01567e4a8
    - 7a96ec2943dd38cc
  x: 205
  'y': 210
  wires:
    - - e8dfc067.c65a1
- id: 6e5fe766309ce370
  type: change
  z: f6aef2f1.dd52e8
  name: POSITION
  rules:
    - t: set
      p: action
      pt: msg
      to: POSITION
      tot: str
  action: ''
  property: ''
  from: ''
  to: ''
  reg: false
  x: 640
  'y': 580
  wires:
    - - a0f1b25d.56ebd8
- id: c80c722c5806b680
  type: link in
  z: f6aef2f1.dd52e8
  name: Telegram-To-All
  links:
    - 1ba3302a5169676e
  x: 205
  'y': 250
  wires:
    - - 469af85aaf8fe04b
- id: 469af85aaf8fe04b
  type: credentials
  z: f6aef2f1.dd52e8
  name: K-CM
  props:
    - value: telegramrecipients
      type: msg
  x: 320
  'y': 250
  wires:
    - - ec21e2dfc2fb77be
