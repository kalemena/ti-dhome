- id: 237573f3.977b64
  type: tab
  label: Sensors-Zigbee
  disabled: false
  info: ''
- id: 30f85ff48f067eed
  type: junction
  z: 237573f3.977b64
  x: 230
  'y': 230
  wires:
    - - 19b35f3c24c461f3
      - 74c7927ff4ba8967
- id: 0c53d09c8dbc9543
  type: junction
  z: 237573f3.977b64
  x: 560
  'y': 480
  wires:
    - - fe18c704095d647f
      - c4ae1b832667595b
- id: e741c0dd196047b8
  type: junction
  z: 237573f3.977b64
  x: 860
  'y': 950
  wires:
    - - e7387eae.824b38
- id: 5c6102c856185de0
  type: junction
  z: 237573f3.977b64
  x: 1010
  'y': 250
  wires:
    - - 78c90ae53c32e0c1
      - 5cb273112e37d0f8
- id: 7f3cf2681e6ff375
  type: junction
  z: 237573f3.977b64
  x: 880
  'y': 440
  wires:
    - - 274d1df9.f97ce2
- id: 86cbb5a82f8c295f
  type: junction
  z: 237573f3.977b64
  x: 880
  'y': 480
  wires:
    - - 1888e2d7.750abd
- id: af4c7c829d66b4c1
  type: junction
  z: 237573f3.977b64
  x: 760
  'y': 280
  wires:
    - - 73543382a5b7bdf9
      - 5c530aa567a3608b
- id: e40e5bbf.43be98
  type: comment
  z: 237573f3.977b64
  name: ZigBee Events
  info: ''
  x: 100
  'y': 100
  wires: []
- id: 4a04431c.fcc3ec
  type: catch
  z: 237573f3.977b64
  name: ''
  scope: null
  uncaught: false
  x: 110
  'y': 40
  wires:
    - - 60b06b25.f9c98c
- id: 60b06b25.f9c98c
  type: link out
  z: 237573f3.977b64
  name: General CatchAll
  links:
    - 1bf42829.b3e0b8
  x: 265
  'y': 40
  wires: []
- id: 2b11a227.b0ca06
  type: mqtt in
  z: 237573f3.977b64
  name: ''
  topic: zigbee2mqtt/bridge/logging
  qos: '2'
  datatype: json
  broker: c38452a5.4f84e8
  nl: false
  rap: true
  rh: 0
  inputs: 0
  x: 160
  'y': 140
  wires:
    - - a99de8fd.3bf05
- id: a99de8fd.3bf05
  type: debug
  z: 237573f3.977b64
  name: ZDebug-All
  active: false
  tosidebar: true
  console: false
  tostatus: false
  complete: 'true'
  targetType: full
  statusVal: ''
  statusType: auto
  x: 380
  'y': 140
  wires: []
- id: fde0902d.5c7e88
  type: mqtt in
  z: 237573f3.977b64
  name: ''
  topic: zigbee2mqtt/+
  qos: '2'
  datatype: json
  broker: c38452a5.4f84e8
  nl: false
  rap: true
  rh: 0
  inputs: 0
  x: 120
  'y': 230
  wires:
    - - 30f85ff48f067eed
- id: 378cc77d.34fe
  type: change
  z: 237573f3.977b64
  name: state=TOGGLE
  rules:
    - t: set
      p: payload
      pt: msg
      to: '{"state":"TOGGLE"}'
      tot: json
  action: ''
  property: ''
  from: ''
  to: ''
  reg: false
  x: 720
  'y': 820
  wires:
    - - 1621fcb5.86df33
- id: 1621fcb5.86df33
  type: mqtt out
  z: 237573f3.977b64
  name: ''
  topic: zigbee2mqtt/P02~Celier~OnOff/set
  qos: ''
  retain: ''
  respTopic: ''
  contentType: ''
  userProps: ''
  correl: ''
  expiry: ''
  broker: c38452a5.4f84e8
  x: 1240
  'y': 820
  wires: []
- id: 831f3268.666ba
  type: mqtt out
  z: 237573f3.977b64
  name: ''
  topic: zigbee2mqtt/P03~Salon~OnOff01/set
  qos: ''
  retain: ''
  respTopic: ''
  contentType: ''
  userProps: ''
  correl: ''
  expiry: ''
  broker: c38452a5.4f84e8
  x: 1300
  'y': 730
  wires: []
- id: 7545dbe9.bad7e4
  type: debug
  z: 237573f3.977b64
  name: ''
  active: false
  tosidebar: true
  console: false
  tostatus: false
  complete: 'true'
  targetType: full
  statusVal: ''
  statusType: auto
  x: 240
  'y': 870
  wires: []
- id: 56f59bd0.4be85c
  type: switch
  z: 237573f3.977b64
  name: ''
  property: payload.action
  propertyType: msg
  rules:
    - t: eq
      v: 'on'
      vt: str
    - t: eq
      v: 'off'
      vt: str
  checkall: 'true'
  repair: false
  outputs: 2
  x: 520
  'y': 950
  wires:
    - - 82918784.6b6d58
    - - 1b5806ce.1cdb99
- id: bf3689b6.1a9aa8
  type: mqtt in
  z: 237573f3.977b64
  name: ''
  topic: zigbee2mqtt/R01~ChD~OnOff
  qos: '2'
  datatype: json
  broker: c38452a5.4f84e8
  nl: false
  rap: true
  rh: 0
  inputs: 0
  x: 170
  'y': 910
  wires:
    - - 7545dbe9.bad7e4
      - 56f59bd0.4be85c
- id: 82918784.6b6d58
  type: change
  z: 237573f3.977b64
  name: state=ON
  rules:
    - t: set
      p: payload
      pt: msg
      to: '{"state":"ON"}'
      tot: json
  action: ''
  property: ''
  from: ''
  to: ''
  reg: false
  x: 710
  'y': 930
  wires:
    - - e741c0dd196047b8
- id: e7387eae.824b38
  type: mqtt out
  z: 237573f3.977b64
  name: ''
  topic: zigbee2mqtt/P01~ChD~Lit/set
  qos: ''
  retain: ''
  respTopic: ''
  contentType: ''
  userProps: ''
  correl: ''
  expiry: ''
  broker: c38452a5.4f84e8
  x: 1230
  'y': 920
  wires: []
- id: 28b226fd.f70f5a
  type: inject
  z: 237573f3.977b64
  name: ''
  props:
    - p: payload
  repeat: ''
  crontab: ''
  once: false
  onceDelay: 0.1
  topic: ''
  payload: P01220vDam
  payloadType: str
  x: 720
  'y': 890
  wires:
    - - 70b16aec.fca994
- id: 1b5806ce.1cdb99
  type: change
  z: 237573f3.977b64
  name: state=OFF
  rules:
    - t: set
      p: payload
      pt: msg
      to: '{"state":"OFF"}'
      tot: json
  action: ''
  property: ''
  from: ''
  to: ''
  reg: false
  x: 720
  'y': 970
  wires:
    - - e741c0dd196047b8
- id: 70b16aec.fca994
  type: change
  z: 237573f3.977b64
  name: state=TOGGLE
  rules:
    - t: set
      p: payload
      pt: msg
      to: '{"state":"TOGGLE"}'
      tot: json
  action: ''
  property: ''
  from: ''
  to: ''
  reg: false
  x: 910
  'y': 890
  wires:
    - - e7387eae.824b38
- id: 5ea0d18e.5be0f
  type: mqtt in
  z: 237573f3.977b64
  name: ''
  topic: zigbee2mqtt/R06~Salon~Cube
  qos: '2'
  datatype: json
  broker: c38452a5.4f84e8
  nl: false
  rap: true
  rh: 0
  inputs: 0
  x: 180
  'y': 480
  wires:
    - - 6335ea75.a87bd4
      - '59774785.92416'
- id: 6335ea75.a87bd4
  type: debug
  z: 237573f3.977b64
  name: ZDebugR06
  active: false
  tosidebar: true
  console: false
  tostatus: false
  complete: 'true'
  targetType: full
  statusVal: ''
  statusType: auto
  x: 240
  'y': 440
  wires: []
- id: 8977a250.22ff2
  type: comment
  z: 237573f3.977b64
  name: Triggers -> Actions
  info: ''
  x: 110
  'y': 370
  wires: []
- id: '59774785.92416'
  type: switch
  z: 237573f3.977b64
  name: Cube action?
  property: payload.action
  propertyType: msg
  rules:
    - t: eq
      v: tap
      vt: str
    - t: eq
      v: rotate_right
      vt: str
    - t: eq
      v: rotate_left
      vt: str
    - t: eq
      v: shake
      vt: str
    - t: eq
      v: side
      vt: str
    - t: eq
      v: action
      vt: str
  checkall: 'true'
  repair: false
  outputs: 6
  x: 430
  'y': 480
  wires:
    - - 2a74ef94.59aac
    - - 0c53d09c8dbc9543
    - - 0c53d09c8dbc9543
    - - d9a33c04992fc657
    - []
    - []
- id: 2a74ef94.59aac
  type: switch
  z: 237573f3.977b64
  name: Tap Side?
  property: payload.side
  propertyType: msg
  rules:
    - t: eq
      v: '0'
      vt: num
    - t: eq
      v: '3'
      vt: num
  checkall: 'true'
  repair: false
  outputs: 2
  x: 670
  'y': 440
  wires:
    - - 7f3cf2681e6ff375
    - - 86cbb5a82f8c295f
- id: 2f285578099ecddd
  type: mqtt in
  z: 237573f3.977b64
  name: ''
  topic: zigbee2mqtt/R07~Celier~Chaussures
  qos: '2'
  datatype: json
  broker: c38452a5.4f84e8
  nl: false
  rap: true
  rh: 0
  inputs: 0
  x: 200
  'y': 820
  wires:
    - - 32d78d55003433bf
- id: 32d78d55003433bf
  type: switch
  z: 237573f3.977b64
  name: ''
  property: payload.action
  propertyType: msg
  rules:
    - t: eq
      v: single
      vt: str
    - t: eq
      v: double
      vt: str
  checkall: 'true'
  repair: false
  outputs: 2
  x: 520
  'y': 820
  wires:
    - - 378cc77d.34fe
    - []
- id: 567f5722b1de5166
  type: comment
  z: 237573f3.977b64
  name: Shake the cube to toggle cozy light
  info: ''
  x: 1290
  'y': 640
  wires: []
- id: c6bedaf25152623e
  type: change
  z: 237573f3.977b64
  name: state=TOGGLE
  rules:
    - t: set
      p: payload
      pt: msg
      to: '{"state":"TOGGLE"}'
      tot: json
  action: ''
  property: ''
  from: ''
  to: ''
  reg: false
  x: 1040
  'y': 730
  wires:
    - - 831f3268.666ba
- id: 42c65007ee68f7b0
  type: function
  z: 237573f3.977b64
  name: Compute
  func: >-
    var sensor_name = msg.topic.replace("zigbee2mqtt/","")


    // 0=up, 100=down

    var last_position = global.get("tidhome_cache." + sensor_name +
    ".last_position") || 0


    if(msg.payload.action_angle > 20) {
        position = Math.min(100, last_position + 25)
    } else if(msg.payload.action_angle < 20) {
        position = Math.max(0, last_position - 25)
    }


    global.set("tidhome_cache." + sensor_name + ".last_position", position);


    // pass through

    return {
        payload: {
            position: position
            }
        };
  outputs: 1
  noerr: 0
  initialize: ''
  finalize: ''
  libs: []
  x: 1020
  'y': 590
  wires:
    - - a18b7635bb4482ed
- id: c4ae1b832667595b
  type: debug
  z: 237573f3.977b64
  name: ZDebugR06Rotate
  active: false
  tosidebar: true
  console: false
  tostatus: false
  complete: 'true'
  targetType: full
  statusVal: ''
  statusType: auto
  x: 700
  'y': 480
  wires: []
- id: a18b7635bb4482ed
  type: debug
  z: 237573f3.977b64
  name: ''
  active: false
  tosidebar: true
  console: false
  tostatus: false
  complete: 'true'
  targetType: full
  statusVal: ''
  statusType: auto
  x: 1220
  'y': 590
  wires: []
- id: fe18c704095d647f
  type: switch
  z: 237573f3.977b64
  name: Rotate action?
  property: payload
  propertyType: msg
  rules:
    - t: hask
      v: action_angle
      vt: str
  checkall: 'true'
  repair: false
  outputs: 1
  x: 690
  'y': 520
  wires:
    - - 42c65007ee68f7b0
- id: 1888e2d7.750abd
  type: change
  z: 237573f3.977b64
  name: CLOSE
  rules:
    - t: set
      p: action
      pt: msg
      to: CLOSE
      tot: str
  action: ''
  property: ''
  from: ''
  to: ''
  reg: false
  x: 1020
  'y': 480
  wires:
    - - 1e78a35a02bb00d7
- id: 274d1df9.f97ce2
  type: change
  z: 237573f3.977b64
  name: OPEN
  rules:
    - t: set
      p: action
      pt: msg
      to: OPEN
      tot: str
  action: ''
  property: ''
  from: ''
  to: ''
  reg: false
  x: 1010
  'y': 440
  wires:
    - - 1e78a35a02bb00d7
- id: 6ec0d7f989e759a4
  type: comment
  z: 237573f3.977b64
  name: Shake the cube to Open/Close shutters
  info: ''
  x: 1300
  'y': 450
  wires: []
- id: 4343d80627f170c9
  type: link in
  z: 237573f3.977b64
  name: Zigbee-GroupB
  links:
    - e7e52fec716f59a2
  x: 135
  'y': 1560
  wires:
    - - 5ff54aa28a48a69b
- id: 7b79b431f2370272
  type: inject
  z: 237573f3.977b64
  name: 14h30
  props:
    - p: payload
    - p: topic
      vt: str
  repeat: ''
  crontab: 30 14 * * *
  once: false
  onceDelay: 0.1
  topic: ''
  payloadType: date
  x: 110
  'y': 1170
  wires:
    - - 0c25f5688e5a94dd
- id: 0c25f5688e5a94dd
  type: change
  z: 237573f3.977b64
  name: state=ON
  rules:
    - t: set
      p: payload
      pt: msg
      to: '{"state":"ON"}'
      tot: json
  action: ''
  property: ''
  from: ''
  to: ''
  reg: false
  x: 280
  'y': 1170
  wires:
    - - 202fbe5871e17867
- id: 821fafeae2bba567
  type: change
  z: 237573f3.977b64
  name: state=OFF
  rules:
    - t: set
      p: payload
      pt: msg
      to: '{"state":"OFF"}'
      tot: json
  action: ''
  property: ''
  from: ''
  to: ''
  reg: false
  x: 290
  'y': 1210
  wires:
    - - 202fbe5871e17867
- id: 8198cd909f51e2d6
  type: inject
  z: 237573f3.977b64
  name: 22h30
  props:
    - p: payload
    - p: topic
      vt: str
  repeat: ''
  crontab: 30 22 * * *
  once: false
  onceDelay: 0.1
  topic: ''
  payloadType: date
  x: 110
  'y': 1210
  wires:
    - - 821fafeae2bba567
- id: 65276d7be42044b8
  type: comment
  z: 237573f3.977b64
  name: Triggers -> Actions -> Aquarium
  info: ''
  x: 150
  'y': 1130
  wires: []
- id: f4efc56732fede78
  type: mqtt out
  z: 237573f3.977b64
  name: ''
  topic: zigbee2mqtt/P06~Sapin~OnOff/set
  qos: ''
  retain: ''
  respTopic: ''
  contentType: ''
  userProps: ''
  correl: ''
  expiry: ''
  broker: c38452a5.4f84e8
  x: 1290
  'y': 680
  wires: []
- id: fbf337296d4e32cb
  type: change
  z: 237573f3.977b64
  name: state=TOGGLE
  rules:
    - t: set
      p: payload
      pt: msg
      to: '{"state":"TOGGLE"}'
      tot: json
  action: ''
  property: ''
  from: ''
  to: ''
  reg: false
  x: 1040
  'y': 680
  wires:
    - - f4efc56732fede78
- id: d9a33c04992fc657
  type: switch
  z: 237573f3.977b64
  name: Shake action?
  property: payload.side
  propertyType: msg
  rules:
    - t: eq
      v: '0'
      vt: str
    - t: eq
      v: '1'
      vt: str
    - t: eq
      v: '2'
      vt: str
    - t: eq
      v: '3'
      vt: str
    - t: eq
      v: '4'
      vt: str
    - t: eq
      v: '5'
      vt: str
  checkall: 'true'
  repair: false
  outputs: 6
  x: 690
  'y': 590
  wires:
    - - 7f3cf2681e6ff375
    - - fbf337296d4e32cb
    - - fbf337296d4e32cb
    - - 86cbb5a82f8c295f
    - - fbf337296d4e32cb
    - - fbf337296d4e32cb
- id: e084ff66fb81099d
  type: link in
  z: 237573f3.977b64
  name: Cmd-Light-Salon
  links:
    - c81f8f99a238d079
  x: 715
  'y': 710
  wires:
    - - c6bedaf25152623e
      - fbf337296d4e32cb
- id: 55c9b79de541353f
  type: inject
  z: 237573f3.977b64
  name: OPEN
  props:
    - p: action
      v: OPEN
      vt: str
  repeat: ''
  crontab: ''
  once: false
  onceDelay: 0.1
  topic: ''
  x: 100
  'y': 1390
  wires:
    - - 6125ee9d06132b9e
- id: bb32a909665cb2a1
  type: function
  z: 237573f3.977b64
  name: Shift
  func: |-

    if(msg.topics.length > 0) {
        return [
            {
                topic: msg.topics.pop(0),
                position: msg.position
            },
            {
                topics: msg.topics,
                position: msg.position
            },
        ]
    }
  outputs: 2
  noerr: 0
  initialize: ''
  finalize: ''
  libs: []
  x: 840
  'y': 1400
  wires:
    - - fcaa4989aed7cefb
    - - b4ea625be1d52582
- id: b4ea625be1d52582
  type: delay
  z: 237573f3.977b64
  name: ''
  pauseType: delay
  timeout: '4'
  timeoutUnits: seconds
  rate: '1'
  nbRateUnits: '1'
  rateUnits: second
  randomFirst: '1'
  randomLast: '5'
  randomUnits: seconds
  drop: false
  allowrate: false
  outputs: 1
  x: 840
  'y': 1460
  wires:
    - - bb32a909665cb2a1
- id: 76df2179d1645b64
  type: mqtt out
  z: 237573f3.977b64
  name: ''
  topic: ''
  qos: ''
  retain: ''
  respTopic: ''
  contentType: ''
  userProps: ''
  correl: ''
  expiry: ''
  broker: c38452a5.4f84e8
  x: 1180
  'y': 1400
  wires: []
- id: fbadbc9c65b425ab
  type: inject
  z: 237573f3.977b64
  name: CLOSE
  props:
    - p: action
      v: CLOSE
      vt: str
  repeat: ''
  crontab: ''
  once: false
  onceDelay: 0.1
  topic: ''
  x: 100
  'y': 1440
  wires:
    - - 6125ee9d06132b9e
- id: f576c3026a84db30
  type: link in
  z: 237573f3.977b64
  name: Zigbee-GroupA
  links:
    - 1e78a35a02bb00d7
    - a0f1b25d.56ebd8
    - fecb20f01567e4a8
  x: 135
  'y': 1340
  wires:
    - - 6125ee9d06132b9e
- id: 1e78a35a02bb00d7
  type: link out
  z: 237573f3.977b64
  name: ''
  mode: link
  links:
    - f576c3026a84db30
  x: 1165
  'y': 490
  wires: []
- id: ae90c12d0555d3f3
  type: comment
  z: 237573f3.977b64
  name: Triggers => Actions -> Shutters
  info: ''
  x: 150
  'y': 1290
  wires: []
- id: fcaa4989aed7cefb
  type: function
  z: 237573f3.977b64
  name: Position
  func: |-

    return {
        payload: {
            "position": msg.position
        },
        topic: "zigbee2mqtt/" + msg.topic + "/set"
    }
  outputs: 1
  noerr: 0
  initialize: ''
  finalize: ''
  libs: []
  x: 1020
  'y': 1400
  wires:
    - - 76df2179d1645b64
- id: c790a3e82c6d73a9
  type: inject
  z: 237573f3.977b64
  name: 25%
  props:
    - p: action
      v: POSITION
      vt: str
    - p: position
      v: '25'
      vt: str
  repeat: ''
  crontab: ''
  once: false
  onceDelay: 0.1
  topic: ''
  x: 100
  'y': 1490
  wires:
    - - 6125ee9d06132b9e
- id: c417e909269f35d0
  type: change
  z: 237573f3.977b64
  name: 100=OPEN
  rules:
    - t: set
      p: position
      pt: msg
      to: '100'
      tot: str
  action: ''
  property: ''
  from: ''
  to: ''
  reg: false
  x: 610
  'y': 1390
  wires:
    - - bb32a909665cb2a1
- id: 1731c4bfa24e14af
  type: switch
  z: 237573f3.977b64
  name: ''
  property: action
  propertyType: msg
  rules:
    - t: eq
      v: OPEN
      vt: str
    - t: eq
      v: CLOSE
      vt: str
    - t: eq
      v: POSITION
      vt: str
  checkall: 'false'
  repair: false
  outputs: 3
  x: 440
  'y': 1430
  wires:
    - - c417e909269f35d0
    - - 77c1b9ba74072a83
    - - 03e32f259d5a2f71
- id: 77c1b9ba74072a83
  type: change
  z: 237573f3.977b64
  name: 0=CLOSE
  rules:
    - t: set
      p: position
      pt: msg
      to: '0'
      tot: str
  action: ''
  property: ''
  from: ''
  to: ''
  reg: false
  x: 600
  'y': 1430
  wires:
    - - bb32a909665cb2a1
- id: 03e32f259d5a2f71
  type: change
  z: 237573f3.977b64
  name: '?=POSITION'
  rules: []
  action: ''
  property: ''
  from: ''
  to: ''
  reg: false
  x: 610
  'y': 1470
  wires:
    - - bb32a909665cb2a1
- id: 6125ee9d06132b9e
  type: change
  z: 237573f3.977b64
  name: Group A
  rules:
    - t: set
      p: topics
      pt: msg
      to: tidhome.groups.groupA
      tot: global
      dc: true
  action: ''
  property: ''
  from: ''
  to: ''
  reg: false
  x: 270
  'y': 1430
  wires:
    - - 1731c4bfa24e14af
- id: 5ff54aa28a48a69b
  type: change
  z: 237573f3.977b64
  name: Group B
  rules:
    - t: set
      p: topics
      pt: msg
      to: tidhome.groups.groupB
      tot: global
      dc: true
  action: ''
  property: ''
  from: ''
  to: ''
  reg: false
  x: 270
  'y': 1560
  wires:
    - - 1731c4bfa24e14af
- id: 6a40ac79b063b25b
  type: mqtt out
  z: 237573f3.977b64
  name: ''
  topic: ''
  qos: ''
  retain: ''
  respTopic: ''
  contentType: ''
  userProps: ''
  correl: ''
  expiry: ''
  broker: c38452a5.4f84e8
  x: 800
  'y': 1190
  wires: []
- id: 202fbe5871e17867
  type: change
  z: 237573f3.977b64
  name: Group C
  rules:
    - t: set
      p: topics
      pt: msg
      to: tidhome.groups.groupC
      tot: global
      dc: true
  action: ''
  property: ''
  from: ''
  to: ''
  reg: false
  x: 450
  'y': 1190
  wires:
    - - 625b0b8308561072
- id: 625b0b8308561072
  type: function
  z: 237573f3.977b64
  name: State
  func: |-

    return {
        payload: {
            "state": msg.payload.state
        },
        topic: "zigbee2mqtt/" + msg.topics.pop(0) + "/set"
    }
  outputs: 1
  noerr: 0
  initialize: ''
  finalize: ''
  libs: []
  x: 630
  'y': 1190
  wires:
    - - 6a40ac79b063b25b
- id: 19b35f3c24c461f3
  type: debug
  z: 237573f3.977b64
  name: ZDebugEvent
  active: false
  tosidebar: true
  console: false
  tostatus: false
  complete: 'true'
  targetType: full
  statusVal: ''
  statusType: auto
  x: 360
  'y': 210
  wires: []
- id: 74c7927ff4ba8967
  type: function
  z: 237573f3.977b64
  name: Name?
  func: |-
    msg.sensor_name = msg.topic.replace("zigbee2mqtt/","")
    return msg
  outputs: 1
  noerr: 0
  initialize: ''
  finalize: ''
  libs: []
  x: 340
  'y': 250
  wires:
    - - c84474e1397f451b
- id: c84474e1397f451b
  type: split
  z: 237573f3.977b64
  name: ''
  splt: \n
  spltType: str
  arraySplt: 1
  arraySpltType: len
  stream: false
  addname: topic
  x: 490
  'y': 250
  wires:
    - - 0d42917b315ef570
- id: 742f21995d2933d4
  type: function
  z: 237573f3.977b64
  name: Store Global
  func: |-
    var uniqueName = "tidhome_zigbee." + msg.sensor_name + "." + msg.topic
    msg.unique_name = uniqueName
    global.set(uniqueName, msg.payload)
    global.set("tidhome_zigbee." + msg.sensor_name + ".ts", Date.now())
    return msg
  outputs: 1
  noerr: 0
  initialize: ''
  finalize: ''
  libs: []
  x: 510
  'y': 290
  wires:
    - - fceb63cff2a35ce6
      - a7356557b8298259
- id: 73543382a5b7bdf9
  type: function
  z: 237573f3.977b64
  name: sensors_value
  func: >-
    let fields = { "value": Number(msg.payload) }

    let tags = { "type": "zigbee-" + msg.topic, "location": msg.sensor_name }


    var msgres = {
        topic: "zigbee-" + msg.topic,
        payload: {
            payload: [fields, tags],
            measurement: "sensors"
        }
    }


    node.status({ fill: "blue", shape: "dot", text: msg.sensor_name + "/" +
    msg.topic + ": " + Number(msg.payload) });


    return msgres
  outputs: 1
  noerr: 0
  initialize: ''
  finalize: ''
  libs: []
  x: 870
  'y': 250
  wires:
    - - 5c6102c856185de0
- id: 0d42917b315ef570
  type: function
  z: 237573f3.977b64
  name: IsNumeric
  func: |-
    function isNumeric(n) {
        return !isNaN(parseFloat(n)) && isFinite(n);
    }

    // convert to numeric if possible
    if (isNumeric(msg.payload)) {
        msg.payload = Number(msg.payload)
    }

    return msg;
  outputs: 1
  noerr: 0
  initialize: ''
  finalize: ''
  libs: []
  x: 340
  'y': 290
  wires:
    - - 742f21995d2933d4
- id: fceb63cff2a35ce6
  type: switch
  z: 237573f3.977b64
  name: ''
  property: payload
  propertyType: msg
  rules:
    - t: istype
      v: number
      vt: number
    - t: istype
      v: boolean
      vt: boolean
    - t: else
  checkall: 'true'
  repair: false
  outputs: 3
  x: 680
  'y': 290
  wires:
    - - af4c7c829d66b4c1
    - - af4c7c829d66b4c1
    - - 57c69d69fe19c4b3
- id: 57c69d69fe19c4b3
  type: debug
  z: 237573f3.977b64
  name: ZDebug
  active: false
  tosidebar: true
  console: false
  tostatus: false
  complete: 'true'
  targetType: full
  statusVal: ''
  statusType: auto
  x: 850
  'y': 310
  wires: []
- id: 78c90ae53c32e0c1
  type: link out
  z: 237573f3.977b64
  name: link out 1
  mode: link
  links:
    - e72a9a6d97ae5b4a
  x: 1075
  'y': 250
  wires: []
- id: 5c530aa567a3608b
  type: function
  z: 237573f3.977b64
  name: sensors_zigbee_X
  func: >-
    var fieldName = "zigbee_" + msg.topic

    var fields = { [fieldName] : Number(msg.payload) }


    var tags = { "location": msg.sensor_name }


    var msgres = {
        topic: fieldName,
        payload: {
            payload: [fields, tags],
            measurement: "sensors"
        }
    }


    node.status({ fill: "blue", shape: "dot", text: msg.sensor_name + "/" +
    msg.topic + ": " + Number(msg.payload) });


    return msgres
  outputs: 1
  noerr: 0
  initialize: ''
  finalize: ''
  libs: []
  x: 880
  'y': 200
  wires:
    - - 5c6102c856185de0
- id: 5cb273112e37d0f8
  type: debug
  z: 237573f3.977b64
  name: ZDebug
  active: false
  tosidebar: true
  console: false
  tostatus: false
  complete: 'true'
  targetType: full
  statusVal: ''
  statusType: auto
  x: 1120
  'y': 200
  wires: []
- id: a7356557b8298259
  type: switch
  z: 237573f3.977b64
  name: ''
  property: sensor_name
  propertyType: msg
  rules:
    - t: regex
      v: ^S.*
      vt: str
      case: false
    - t: else
  checkall: 'true'
  repair: false
  outputs: 2
  x: 680
  'y': 350
  wires:
    - - b8ba0185a07f3b41
    - []
- id: b8ba0185a07f3b41
  type: debug
  z: 237573f3.977b64
  name: ZDebug
  active: false
  tosidebar: true
  console: false
  tostatus: false
  complete: 'true'
  targetType: full
  statusVal: ''
  statusType: auto
  x: 850
  'y': 350
  wires: []
