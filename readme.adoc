
# Ti-DHome

This is a Home automation project.

Pronounced "Ty d'Homme" stands for *little man* in French.

## Description

A home server can be put in place to monitor and act on various environment sensors.

## History

Initially, this all started in 2010 when arriving in my new home.

Room temperatures were not perfect, with high difference between rooms and strange weather-related discrepencencies.

## Goal

Room can be tracked in temperature and humidity while heaters can be switched on/off based on precise room sensor metrics.

# Design approach

This repository is an attempt to put together the source and explanation to build minimalist home automation.

Minimal approach means:

* avoid complex monolithic framework used here and there on automation
* client(s)/server(s) plugs together using *ANY* progamming language by leveraging message queues (MQTT)
* simple arduino sketches for sensors
* simple datastore (any or multiple)
* deploy as much as possible with automation using [Docker](https://www.docker.com/)

# Material

Hardware used for sensors/actors:

* Arduino with radio enabled (JeeNode compatible): 15+ low cost sensors
* link:http://www.currentcost.com/product-envir.html[CurrentCost EnviR]: Main + 9 plugs
* link:http://www.rfxcom.com/[RFXtrx433]: Weather Station, Window motor openers, Alarm monitoring
* Sainsmart relay board: 16 relays
* Fanless low-consumption servers link:http://cubieboard.org[Cubieboard v2] or multi-purpose Core i3 with SSD)
* few cheap components (for téléinfo)

image:/res/Schema.jpg?raw=true[Hardware overview]

# Schematic

![Architecture](/res/Architecture.png?raw=true "Architecture overview")

# Dashboard

A simple Dashboard uses Grafana and InfluxDB as storage.

![Dashboard Power](/res/dashboard-power-1.png)

![Dashboard Sensors](/res/dashboard-sensors-1.png)

![Dashboard System](/res/dashboard-system-1.png)


# How-To

## Setup each module

Everything can be setup at need.

* [Téléinfo](/modules/teleinfo)
* [Web Relays](https://github.com/kalemena/ti-dhome-web-relay-board)
* [RfxTrx433](/modules/rfxtrx433)
* [CurrentCost](/modules/currentcost)
* [Sensors](https://github.com/kalemena/ti-dhome-sensors)
* Database is up to user. Using CouchDB, but this is not shared for now.


## Install software


Central service is fully contained into Docker container.
The service has an inner mosquitto and uses pre-build strategies to wire-up the few modules.
Idea is to leverage [Node RED](http://nodered.org)

* steps: 
 * install [Docker](https://www.docker.com/)
 * change the below command line to map your USB devices.
 * connect to http://localhost:1880, change the project flow based on need. 

```js
$ git clone https://github.com/kalemena/ti-dhome.git
$ docker-compose up -d
```

### Used node-red nodes

* http://flows.nodered.org/node/node-red-contrib-rfxcom
* http://flows.nodered.org/node/node-red-node-openweathermap

### Project default flows

![Flows](/res/nodered-sensors-input.png?raw=true "Node-red flows")


### Security

$ openssl req -subj '/CN=localhost' -x509 -newkey rsa:4096 -nodes -keyout key.pem -out cert.pem -days 365


### Links

https://air.imag.fr/index.php/Developing_IoT_Mashups_with_Docker,_MQTT,_Node-RED,_InfluxDB,_Grafana

https://github.com/GladysAssistant/Gladys/blob/master/docker/Dockerfile