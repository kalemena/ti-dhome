
= Ti-DHome

ifdef::env-github[]
:imagesdir: /
endif::[]

This is a Home automation project. Pronounced "Ti d'Homme" stands for *little man* in French.

Home server monitors and act on various environment events such as sensors.

For example, sensors send room temperatures, and a small but flexible workflow allows to orchestrate heaters in these rooms, taking into account time of day, week/year period, absence from home and global weather feeds.

image:res/Schema.jpg?raw=true[Hardware overview]

= Design approach

The source and explanation in this repository are following few principles:

* avoid complex monolithic framework used here and there on automation
* client(s)/server(s) plugs together using *ANY* progamming language by leveraging message queues (MQTT)
* simple arduino sketches for sensors
* simple datastore (any, multiple, interchangeable)
* deploy as much as possible with automation using for example link:https://www.docker.com/[Docker]

image:res/Architecture.png?raw=true[Architecture]

= Material

Hardware used for sensors/actors:

* Arduino with radio enabled (JeeNode compatible): 15+ low cost sensors
* link:http://www.currentcost.com/product-envir.html[CurrentCost EnviR]: Main + 9 plugs
* link:http://www.rfxcom.com/[RFXtrx433]: Weather Station, Window motor openers, Alarm monitoring
* Sainsmart relay board: 16 relays
* Fanless low-consumption servers link:http://cubieboard.org[Cubieboard v2] or multi-purpose Core i3 with SSD)
* few cheap components (for téléinfo)

= Dashboard

A simple Dashboard uses Grafana and InfluxDB as storage.

image:res/dashboard-power-1.png[Dashboard Power]

image:res/dashboard-sensors-1.png[Dashboard Sensors]

image:res/dashboard-system-1.png[Dashboard System]

= How-To

== Setup each module

Everything can be setup at need.

* link:/modules/teleinfo[Téléinfo]
* link:https://github.com/kalemena/ti-dhome-web-relay-board[Web Relays]
* link:/modules/rfxtrx433[RfxTrx433]
* link:/modules/currentcost[CurrentCost]
* link:https://github.com/kalemena/ti-dhome-sensors[Sensors]
* Database is up to user. Using CouchDB, but this is not shared for now.

== Install software

Central service is fully contained into Docker container.
The service has an inner mosquitto and uses pre-build strategies to wire-up the few modules.
Idea is to leverage link:http://nodered.org[Node RED]

* steps: 
 * install link:https://www.docker.com/[Docker]
 * change the below command line to map your USB devices.
 * connect to http://localhost:1880, change the project flow based on need. 

    $ git clone https://github.com/kalemena/ti-dhome.git
    $ docker-compose up -d

=== Project default flows

image:res/nodered-sensors-input.png?raw=true[Node-RED Flows]

=== Security

    $ openssl req -subj '/CN=localhost' -x509 -newkey rsa:4096 -nodes -keyout key.pem -out cert.pem -days 365

=== Links

https://air.imag.fr/index.php/Developing_IoT_Mashups_with_Docker,_MQTT,_Node-RED,_InfluxDB,_Grafana

https://github.com/GladysAssistant/Gladys/blob/master/docker/Dockerfile